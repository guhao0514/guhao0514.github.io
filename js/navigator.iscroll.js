(function($,undefined){$.ui.navigator.register(function(){return{pluginName:'iscroll',_init:function(){return this._adjustHtml()._reBindEvent()._initOrg();},_reBindEvent:function(){var me=this,data=me._data;data.isScrollToNext=data.isScrollToNext===undefined?true:data.isScrollToNext;data.isShowShadow=data.isShowShadow===undefined?true:data.isShowShadow;me._loadIscroll();$(window).on('ortchange',$.proxy(me._ortChangeHandler,me));me.on('destroy',function(){$(window).off('ortchange',me._ortChangeHandler);data.iScroll.destroy();});return me;},_adjustHtml:function(){var me=this,data=me._data,$el=me.root().addClass('ui-navigator'),$navScroller=$el.find('ul'),$navWrapper=$el.find('.ui-navigator-wrapper'),$navList=$navScroller.find('li'),scrollerSumWidth=[0];!$navWrapper.length&&$navScroller.wrap('<div class="ui-navigator-wrapper"></div>');$navScroller.find('li').each(function(index){scrollerSumWidth[index]=index?(scrollerSumWidth[index-1]+this.offsetWidth):(scrollerSumWidth[index]+this.offsetLeft-$navScroller[0].offsetLeft+this.offsetWidth);});$.extend(data,{_$navWrapper:$el.find('.ui-navigator-wrapper'),_$navScroller:$navScroller.width(scrollerSumWidth[$navList.length-1]),_$navList:$navList,_scrollerNum:$navList.length,_scrollerSumWidth:scrollerSumWidth,_$fixElemLeft:$el.find('.ui-navigator-fixleft'),_$fixElemRight:$el.find('.ui-navigator-fixright')});return me;},_loadIscroll:function(){var me=this,data=me._data;data.iScroll=iScroll(data._$navWrapper.get(0),data.iScrollOpts=$.extend({hScroll:true,vScroll:false,hScrollbar:false,vScrollbar:false},data.iScrollOpts,{onScrollStart:function(e){me.trigger('scrollstart',e);},onScrollMove:function(e){me.trigger('scrollmove',e);},onScrollEnd:function(e){data.isShowShadow&&me._setShadow();me.trigger('scrollend',e);}}));return me;},_setShadow:function(){var me=this,data=me._data,$navWrapper=data._$navWrapper,shadowClass={left:'ui-navigator-shadowl',right:'ui-navigator-shadowr',all:'ui-navigator-shadowall'},iScroll=data.iScroll,movedX=iScroll.x;if(movedX<0){$navWrapper.removeClass(shadowClass['left']+' '+shadowClass['right']).addClass(shadowClass['all']);if(movedX<=iScroll.maxScrollX){$navWrapper.removeClass(shadowClass['all']+' '+shadowClass['right']).addClass(shadowClass['left']);}}else{$navWrapper.removeClass(shadowClass['all']+' '+shadowClass['left']);iScroll.hScroll?$navWrapper.addClass(shadowClass['right']):$navWrapper.removeClass(shadowClass['all']+' '+shadowClass['left']+' '+shadowClass['right']);}
return me;},_scrollToNext:function(index,pos){var me=this,data=me._data,scrollerSumWidth=data._scrollerSumWidth,iScroll=data.iScroll;iScroll.scrollTo(pos=='last'?iScroll.wrapperW-(scrollerSumWidth[index+1]||scrollerSumWidth[scrollerSumWidth.length-1]):pos=='first'?(-scrollerSumWidth[index-2]||0):iScroll.x,0,400);return me;},_getPos:function(index){var me=this,data=me._data,iScroll=data.iScroll,movedXDis=Math.abs(iScroll.x)||0,scrollerSumWidth=data._scrollerSumWidth,$navList=data._$navList,thisOffsetDis=scrollerSumWidth[index]-movedXDis,preOffsetDis=scrollerSumWidth[(index-1)||0]-movedXDis,nextOffsetDis=(scrollerSumWidth[index+1]||scrollerSumWidth[scrollerSumWidth.length-1])-movedXDis,wrapperWidth=iScroll.wrapperW;return(thisOffsetDis>=wrapperWidth||nextOffsetDis>wrapperWidth)?'last':(thisOffsetDis<=$navList[index].offsetWidth||preOffsetDis<$navList[index-1].offsetWidth)?'first':'middle';},_ortChangeHandler:function(){var me=this,data=me._data,iScroll=data.iScroll;iScroll.refresh();me._setShadow();data._$navWrapper.width(iScroll.wrapperW-iScroll.wrapperOffsetLeft);},switchTo:function(index,isDef,e){var me=this,data=me._data;me.switchToOrg(index,isDef,e);if(!data._$tabList.eq(index).hasClass('ui-navigator-fix')){var $fixElemLeft=data._$fixElemLeft,index=index-($fixElemLeft.length?$fixElemLeft.length:0),pos=me._getPos(index);isDef&&data.isShowShadow&&me._setShadow();data.isScrollToNext&&me._scrollToNext(index,pos);}
return me;}}});})(Zepto);